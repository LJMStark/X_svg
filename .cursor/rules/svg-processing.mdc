---
globs: batch_process_tweets.py,process_tweets.py
description: SVG生成和处理相关规范
---

# SVG生成和处理规范

## SVG生成流程

1. **提示词处理**: 从 [svg提示词.txt](mdc:svg提示词.txt) 读取系统提示词
2. **API调用**: 使用配置的AI模型生成SVG代码
3. **内容清理**: 移除markdown标记、@import语句
4. **字体替换**: 将网络字体替换为系统字体
5. **中文验证**: 确保SVG内容主要为中文
6. **文件保存**: 保存为UTF-8编码的SVG文件

## SVG清理规则

### 移除内容
- Markdown代码块标记 (```svg 和 ```)
- @import CSS语句
- 网络字体引用

### 字体替换映射
```python
font_replacements = {
    "'Noto Serif SC'": "'Arial', 'Helvetica', sans-serif",
    "'Noto Sans SC'": "'Arial', 'Helvetica', sans-serif", 
    "'Space Mono'": "'Courier New', monospace"
}
```

## 中文内容验证

### 验证标准
- 必须包含至少5个中文字符
- 不允许包含任何英文字母
- 使用正则表达式 `[\u4e00-\u9fff]` 检测中文
- 使用正则表达式 `[A-Za-z]` 检测英文字母

### 重试机制
如果中文验证失败：
1. 追加强制中文约束提示词
2. 重新调用API生成
3. 如果仍失败，移除文本节点中的英文字母

## SVG文件结构

生成的SVG文件应包含：
- 完整的SVG标签结构
- 中文文本内容
- 系统兼容的字体设置
- 适当的样式和布局

## 错误处理

- API调用失败时记录详细错误
- SVG内容为空时跳过保存
- 文件保存失败时记录错误并继续处理
- 支持断点续传，跳过已存在的文件